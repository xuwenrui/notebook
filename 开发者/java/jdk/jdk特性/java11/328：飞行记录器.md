> [!NOTE]
> 飞行记录器，通常指的是在软件或IT领域中的一种性能监控和故障诊断工具，它特指Java平台中的“Java飞行记录器”（Java Flight Recorder, JFR）。这个概念来源于航空领域的“飞行数据记录器”（俗称“黑匣子”），它负责记录飞机飞行过程中的重要数据，以便在发生事故时进行调查分析。
> 
> 在Java上下文中，Java飞行记录器是一个低开销的监控和分析工具，集成在Java Development Kit (JDK)中，从Java 11开始成为OpenJDK的组成部分。它能够连续不断地收集Java虚拟机（JVM）、操作系统以及运行在JVM上的应用程序的各种详细数据，包括但不限于：
> 
> - 性能指标（CPU使用率、内存分配、垃圾收集统计等）
> - 线程活动和死锁信息
> - 方法调用堆栈和编译活动
> - 锁和同步的使用情况
> - I/O和网络活动
> - 异常和错误记录

Java 11 引入了一个称为"飞行记录器"（Flight Recorder）的特性，这是一个强大的监控和诊断工具，它能够以低开销的方式收集详细的运行时数据，包括垃圾收集、JVM和操作系统性能指标、线程活动、锁 contention、编译活动等。飞行记录器原本是Oracle JDK的一部分，但从Java 11（JDK 11）开始，它成为了OpenJDK的一个标准组件，所有用户都可以免费使用这一功能。

### 开启飞行记录器

要在Java 11中使用飞行记录器，可以通过以下几种方式之一开启：

1. **命令行参数**：启动Java应用程序时，添加以下JVM参数：

    ```
    1-XX:StartFlightRecording=OPTIONS
    ```
    
    `OPTIONS`可以是一个或多个配置选项，例如指定记录文件的名称和位置、配置记录的数据类型等。例如，要开始记录并将数据保存到默认位置的文件中，可以使用：

    ```
    1-XX:StartFlightRecording
    ```
    
2. **JFR事件配置文件**：可以通过指定一个事件配置文件来定制记录的内容。例如：

    ```
    1-XX:StartFlightRecording=settings=mysettings.jfc
    ```
    
    其中`mysettings.jfc`是一个包含飞行记录器配置的文件。
    
3. **JVisualVM集成**：Java VisualVM工具从Java 11开始也支持查看飞行记录器数据，无需额外配置即可在运行中的JVM上启动或停止记录。

### 查看飞行记录数据

记录的数据可以通过JDK自带的工具`jfr`命令行工具或者集成在JDK中的`jmc`（Java Mission Control）工具进行查看和分析。

- 使用`jfr`命令可以转换和查看飞行记录文件：
    ```
    1jfr print --events="jdk.CPULoad" myrecording.jfr
    ```
    
- Java Mission Control（JMC）提供了一个图形界面，可以更直观地分析飞行记录数据，包括性能瓶颈识别、线程分析等。
    

### 注意事项

- 飞行记录器在默认情况下可能不会开启，因为它会增加一点点运行时的开销，尽管这个开销相对较小。
- 确保你有足够权限写入记录文件的目标目录。
- 飞行记录器收集的数据可能包含敏感信息，因此处理和存储这些记录文件时需谨慎。

飞行记录器是Java 11及之后版本中一个非常强大的功能，它极大地增强了开发者诊断复杂性能问题的能力。