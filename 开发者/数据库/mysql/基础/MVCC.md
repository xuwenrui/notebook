MVCC 是 Multi-Version Concurrency Control 的缩写，即 多版本并发控制。它是 MySQL InnoDB 引擎用来管理并发访问数据的一种机制。MVCC 通过维护每个行的多个版本来允许多个事务同时读取相同的数据而不损坏数据。

MVCC 的工作原理:

读操作:

- 当一个事务读取一行数据时，它不会访问磁盘上存储的实际数据。相反，它会访问一个 读视图，这是一个在事务开始时的数据库一致快照。
- 这个读视图是使用以下机制构建的：

- Undo 日志: 当一个事务更新一行数据时，旧版本的行不会被覆盖。相反，会创建一个包含旧数据的 undo 日志条目。这允许在更新之前开始的其他事务读取旧版本的行。
- Redo 日志: 当一个事务提交时，会创建一个包含对数据所做更改的 redo 日志条目。这些 redo 日志用于在事务提交时物理更新磁盘上的数据。

写操作:

- 当一个事务更新一行数据时，它不会修改现有版本。相反，它会插入一个包含更新数据的行的 新版本。
- 这个新版本被标记为 当前版本。

MVCC 的优势:

- 提高并发性: MVCC 允许多个事务同时读取相同的数据，而无需锁定整个行。这可以显著提高读流量大的应用程序的性能。
- 非阻塞读: 读操作不会获取它们所访问行的锁。这允许其他事务同时更新相同行，只要它们不与读取事务的读视图冲突。
- 可重复读: 事务可以通过使用 READ COMMITTED 或 REPEATABLE READ 等事务隔离级别来确保它们始终看到相同的数据。

MVCC 的局限性:

- 存储开销增加: 维护多个版本的行会增加数据库所需的存储空间。
- 幻像读: 在某些情况下，事务可能看不到另一个事务在第一个事务开始读取操作后插入的行（这称为幻像读）。可以通过使用 SERIALIZABLE 等更强的 事务隔离级别来避免这种情况。